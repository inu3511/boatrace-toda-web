# ボートレース戸田 予想ツール ユーザーマニュアル

## 目次

1. [はじめに](#はじめに)
2. [インストール方法](#インストール方法)
3. [基本的な使い方](#基本的な使い方)
4. [コマンドリファレンス](#コマンドリファレンス)
5. [予想結果の見方](#予想結果の見方)
6. [トラブルシューティング](#トラブルシューティング)
7. [よくある質問](#よくある質問)
8. [技術情報](#技術情報)

## はじめに

ボートレース戸田予想ツールは、公式サイトから収集したデータを基に機械学習を活用してレース結果を予測するツールです。コース特性、選手成績、モーター性能、気象条件など様々な要素を考慮し、各艇の着順や3連単の組み合わせを予測します。

### 主な機能

- 本日のレース予想
- 指定日・指定レースの予想
- 過去データの収集と分析
- 予測モデルの訓練と評価
- 予想結果の詳細表示

### 特徴

- **戸田競艇場特化**: 戸田競艇場の特性（水面状況、風の影響など）を考慮した予測
- **季節要因考慮**: 季節ごとの特性を加味した予測
- **リアルタイムデータ**: 公式サイトから最新情報を取得
- **使いやすいインターフェース**: コマンドラインで簡単に操作可能

## インストール方法

### 必要環境

- Python 3.8以上
- インターネット接続環境

### 必要ライブラリ

以下のPythonライブラリが必要です：

```
pandas
numpy
scikit-learn
matplotlib
seaborn
joblib
beautifulsoup4
requests
rich
```

### インストール手順

1. リポジトリをクローンまたはダウンロードします：

```bash
git clone https://github.com/yourusername/boatrace-toda-prediction.git
cd boatrace-toda-prediction
```

2. 必要なライブラリをインストールします：

```bash
pip install -r requirements.txt
```

または個別にインストールする場合：

```bash
pip install pandas numpy scikit-learn matplotlib seaborn joblib beautifulsoup4 requests rich
```

## 基本的な使い方

### ツールの起動

コマンドラインから以下のコマンドでツールを起動します：

```bash
python main.py
```

起動すると、以下のようなメインメニューが表示されます：

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ メインメニュー             ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 1: 本日のレース予想        │
│ 2: 指定日のレース予想      │
│ 3: データ収集と処理        │
│ 4: モデル訓練              │
│ 5: 全パイプライン実行      │
│ 0: 終了                    │
└────────────────────────────┘
```

### 基本的な操作フロー

1. **初回使用時**：
   - まず「3: データ収集と処理」を選択し、過去のレースデータを収集します
   - 次に「4: モデル訓練」を選択し、収集したデータを基に予測モデルを訓練します

2. **日常的な使用**：
   - 「1: 本日のレース予想」を選択すると、当日開催されるすべてのレースの予想結果が表示されます
   - 「2: 指定日のレース予想」を選択すると、特定の日付・レース番号を指定して予想できます

3. **定期的なモデル更新**：
   - 「5: 全パイプライン実行」を選択すると、データ収集からモデル訓練、予測までを一括で実行します

## コマンドリファレンス

### コマンドライン引数

ツールはコマンドライン引数を使用して直接特定の機能を実行することもできます：

```bash
# テストを実行
python main.py --test

# 統合テストを実行
python main.py --test-integration

# 通常モード（引数なし）
python main.py
```

### メニュー項目の詳細

#### 1. 本日のレース予想

当日開催される全レースの予想を一括で実行します。各レースの艇別予想と3連単予想が表示されます。

#### 2. 指定日のレース予想

特定の日付とレース番号を指定して予想を実行します。日付はYYYYMMDD形式（例：20240315）で入力します。

#### 3. データ収集と処理

公式サイトから過去のレースデータを収集し、予測に使用できる形式に処理します。収集する日数を指定できます。

#### 4. モデル訓練

収集したデータを使用して予測モデルを訓練します。複数のモデル（ランダムフォレスト、勾配ブースティング）を訓練し、評価結果を表示します。

#### 5. 全パイプライン実行

データ収集、モデル訓練、予測までの全工程を一括で実行します。過去何日分のデータを収集するか、どのモデルを使用するかを指定できます。

## 予想結果の見方

### レース情報

予想結果の最初に表示されるレース情報には、日付、レース番号、気象条件（天候、風向、風速、波高）が含まれます。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ レース情報                                                                   ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 日付: 20240315                                                               │
│ レース番号: 1                                                                │
│ 気象条件: 天候: 晴, 風向: 北, 風速: 3m, 波高: 5cm                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 艇別予想

各艇の予想結果が表形式で表示されます。枠番、選手名、選手登録番号、予想着順、1着確率が含まれます。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 艇別予想                                                                     ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 枠番 │ 選手名   │ 選手登録番号 │ 予想着順 │ 1着確率                         │
├──────┼──────────┼──────────────┼──────────┼─────────────────────────────────┤
│ 1    │ 選手A    │ 4357         │ 1        │ 35.2%                           │
│ 2    │ 選手B    │ 3872         │ 3        │ 15.8%                           │
│ 3    │ 選手C    │ 4512         │ 2        │ 22.5%                           │
│ 4    │ 選手D    │ 3945         │ 4        │ 12.3%                           │
│ 5    │ 選手E    │ 4123         │ 5        │ 8.7%                            │
│ 6    │ 選手F    │ 3698         │ 6        │ 5.5%                            │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3連単予想

予想される3連単の組み合わせが確率順に表示されます。上位5組が表示されます。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 3連単予想（上位5組）                                                         ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 組み合わせ │ 確率                                                           │
├────────────┼────────────────────────────────────────────────────────────────┤
│ 1-3-2      │ 8.25%                                                          │
│ 1-2-3      │ 6.18%                                                          │
│ 3-1-2      │ 5.74%                                                          │
│ 1-3-4      │ 4.32%                                                          │
│ 3-1-4      │ 3.87%                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

## トラブルシューティング

### よくある問題と解決方法

#### データ収集に失敗する

**問題**: 「データ収集・処理に失敗しました」というエラーが表示される

**解決方法**:
- インターネット接続を確認してください
- 指定した日付に実際にレースが開催されているか確認してください
- 公式サイトのレイアウトが変更された可能性があります。最新版のツールを入手してください

#### モデル訓練に失敗する

**問題**: 「モデル訓練に失敗しました」というエラーが表示される

**解決方法**:
- 十分なデータが収集されているか確認してください（最低でも過去30日分推奨）
- 必要なライブラリが正しくインストールされているか確認してください
- ディスク容量が不足していないか確認してください

#### 予測に失敗する

**問題**: 「予想に失敗しました」というエラーが表示される

**解決方法**:
- モデルが正しく訓練されているか確認してください
- 指定した日付・レース番号が正しいか確認してください
- ログファイル（logs/predictor.log）を確認して詳細なエラー内容を確認してください

### ログファイル

ツールは以下のログファイルを生成します：

- `logs/main.log`: メインプログラムのログ
- `logs/collector.log`: データ収集モジュールのログ
- `logs/preprocessor.log`: データ処理モジュールのログ
- `logs/model.log`: 予測モデルモジュールのログ
- `logs/predictor.log`: 予測実行モジュールのログ
- `logs/cli.log`: コマンドラインインターフェースのログ

エラーが発生した場合は、これらのログファイルを確認して詳細な情報を得ることができます。

## よくある質問

### Q: どのくらいの頻度でデータを更新すべきですか？

A: 最新の傾向を反映させるため、週に1回程度のデータ更新をお勧めします。「全パイプライン実行」機能を使用すると、データ収集からモデル訓練までを一括で実行できます。

### Q: 予想の精度はどのくらいですか？

A: 予想精度は様々な要因に左右されますが、一般的に1着予想の的中率は約30%程度、3連単の的中率は約5%程度です。ただし、これはあくまで参考値であり、実際の結果を保証するものではありません。

### Q: 他の競艇場でも使用できますか？

A: このツールはボートレース戸田の特性に特化して設計されています。他の競艇場では水面状況や風の影響が異なるため、予想精度が低下する可能性があります。

### Q: 予想結果をファイルに保存できますか？

A: はい、予想結果は自動的に `results` ディレクトリに JSON 形式で保存されます。例えば、2024年3月15日の第1レースの予想結果は `results/toda_race_20240315_1_prediction.json` として保存されます。

### Q: どのモデルが最も精度が高いですか？

A: 一般的にはランダムフォレストモデルが安定した予測結果を提供しますが、データセットによって最適なモデルは異なります。モデル訓練機能を使用すると、各モデルの評価指標が表示されるので、最も精度の高いモデルを選択できます。

## 技術情報

### システム構成

ボートレース戸田予想ツールは以下のモジュールで構成されています：

1. **データ収集モジュール** (`src/data_collection/collector.py`)
   - 公式サイトからのレースデータ収集
   - 選手情報・モーター情報の取得
   - 気象条件データの取得

2. **データ処理モジュール** (`src/data_processing/preprocessor.py`)
   - データの前処理と整形
   - 特徴量エンジニアリング
   - 予測に必要な統計情報の生成

3. **予測モデルモジュール** (`src/prediction/model.py`)
   - 機械学習モデルの構築
   - モデルの訓練と評価
   - 特徴量重要度の分析

4. **予測実行モジュール** (`src/prediction/predictor.py`)
   - データ収集から予測までの統合
   - 本日のレース予想機能
   - 指定レースの予想機能

5. **ユーザーインターフェースモジュール** (`src/ui/cli.py`)
   - コマンドラインインターフェース
   - リッチテキスト表示
   - ユーザー入力処理

### 予測アルゴリズム

予測には主に以下の機械学習アルゴリズムを使用しています：

- **ランダムフォレスト**: 複数の決定木を組み合わせた安定性の高いアルゴリズム
- **勾配ブースティング**: 弱学習器を逐次的に改善していく高精度なアルゴリズム

### 予測に使用する主な特徴量

- コース番号と着順の関係
- 選手の成績（平均着順、1着率、STタイム平均）
- モーター性能（2連率、3連率）
- ボート性能（2連率、3連率）
- 気象条件（風向、風速、波高）
- 季節要因（月、曜日、季節）

### ディレクトリ構造

```
boatrace_toda_project/
├── data/                  # データ保存ディレクトリ
│   ├── raw/               # 生データ
│   └── processed/         # 処理済みデータ
├── logs/                  # ログファイル
├── models/                # 訓練済みモデル
├── results/               # 予測結果
│   └── graphs/            # 評価グラフ
├── src/                   # ソースコード
│   ├── data_collection/   # データ収集モジュール
│   ├── data_processing/   # データ処理モジュール
│   ├── prediction/        # 予測モジュール
│   └── ui/                # ユーザーインターフェース
├── tests/                 # テストコード
├── main.py                # メインスクリプト
└── README.md              # 説明ファイル
```

---

© 2025 ボートレース戸田予想ツール
